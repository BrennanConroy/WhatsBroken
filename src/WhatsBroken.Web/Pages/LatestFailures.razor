@page "/"
@inject KustoContextFactory KustoContextFactory

<QueryView TResult="TestResult" OnLoadData="OnLoadDataAsync">
    <HeaderContent>
        Test failures in the last 7 days
    </HeaderContent>
    <ChildContent Context="results">
        <TestResultGrid Results="results" />
    </ChildContent>
</QueryView>

@code {
    async Task OnLoadDataAsync(QueryView<TestResult>.LoadDataEventArgs args)
    {
        args.Results = await args.Context.GetFailingTestsAsync(
            DateTime.UtcNow.Date.AddDays(-7),
            DateTime.UtcNow,
            new[] { "dotnet/aspnetcore", "dotnet-aspnetcore" },
            new[] { "refs/heads/master" },
            includeQuarantined: false);
    }
}
