@page "/quarantined"
@inject KustoContextFactory KustoContextFactory

<h1>Currently quarantined tests</h1>

<LoadingOverlay IsLoaded="@IsLoaded">
    <Content>
        <RadzenGrid AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" AllowPaging="false" AllowSorting="true" Data="@Results" ColumnWidth="200px">
            <Columns>
                <RadzenGridColumn TItem="TestCase" Property="Project" Title="Project" />
                <RadzenGridColumn TItem="TestCase" Property="Type" Title="Type" />
                <RadzenGridColumn TItem="TestCase" Property="Method" Title="Method" />
            </Columns>
        </RadzenGrid>
    </Content>
</LoadingOverlay>

@code {
    // We know Blazor will call our initialization code before we can dereference this.
    KustoContext _context = default!;

    bool IsLoaded { get; set; }
    IReadOnlyList<TestCase> Results { get; set; } = Array.Empty<TestCase>();

    protected override async Task OnInitializedAsync()
    {
        _context = await KustoContextFactory.CreateContextAsync();

        Results = await _context.GetQuarantinedTestsAsync(
            new[] { "dotnet/aspnetcore", "dotnet-aspnetcore" },
            new[] { "refs/heads/master" });
        IsLoaded = true;
    }
}
